openapi: 3.0.3
info:
  title: Smart Parcel Locker API
  version: v1
servers:
  - url: http://localhost:8080/api/v1
paths:
  /parcels/{parcel_id}:
    get:
      summary: Get parcel by id
      tags: [Parcels]
      parameters:
        - in: path
          name: parcel_id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Parcel retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParcelDetailResponse'
        '400':
          description: Bad request (invalid uuid)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '404':
          description: Parcel not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'

  /lockers/available:
    get:
      summary: List available lockers
      tags: [Lockers]
      responses:
        '200':
          description: Active lockers listed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LockerAvailableResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'

  /admins:
    post:
      summary: Create an admin user
      tags: [Admin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminCreateRequest'
      responses:
        '201':
          description: Admin created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'

  /admins/{id}:
    get:
      summary: Get admin by id
      tags: [Admin]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Admin retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '404':
          description: Admin not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
    put:
      summary: Update admin
      tags: [Admin]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUpdateRequest'
      responses:
        '200':
          description: Admin updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '404':
          description: Admin not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
    delete:
      summary: Delete admin
      tags: [Admin]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Admin deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIBase'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '404':
          description: Admin not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'

  /admin/locations:
    post:
      summary: Create a location
      tags: [Admin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LocationCreateRequest'
      responses:
        '201':
          description: Location created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocationResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
    get:
      summary: List all locations
      tags: [Admin]
      responses:
        '200':
          description: Locations listed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocationListResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'

  /admin/lockers:
    post:
      summary: Register a locker under a location
      tags: [Admin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LockerCreateRequest'
      responses:
        '201':
          description: Locker created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LockerResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '404':
          description: Location not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
    get:
      summary: List lockers with location info
      tags: [Admin]
      responses:
        '200':
          description: Lockers listed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LockerListResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'

  /admin/lockers/{locker_id}/status:
    patch:
      summary: Change locker status
      tags: [Admin]
      parameters:
        - in: path
          name: locker_id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LockerStatusUpdateRequest'
      responses:
        '200':
          description: Locker status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LockerStatusResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '404':
          description: Locker not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '409':
          description: Conflict (invalid state for action)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'

  /admin/lockers/{locker_id}/compartments:
    post:
      summary: Generate compartments for a locker
      tags: [Admin]
      parameters:
        - in: path
          name: locker_id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompartmentBatchCreateRequest'
      responses:
        '201':
          description: Compartments created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompartmentBatchCreateResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '404':
          description: Locker not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
    get:
      summary: List compartments of a locker
      tags: [Admin]
      parameters:
        - in: path
          name: locker_id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Compartments listed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompartmentListResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '404':
          description: Locker not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'

  /admin/overview:
    get:
      summary: System overview
      tags: [Admin]
      responses:
        '200':
          description: Overview retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminOverviewResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIErrorResponse'

components:
  schemas:
    APIBase:
      type: object
      required: [success]
      properties:
        success:
          type: boolean
        error_code:
          type: string
        error:
          type: string

    APIErrorResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
      example:
        success: false
        error_code: INVALID_REQUEST
        error: invalid request

    Admin:
      type: object
      required: [id, username, password_hash, role]
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        password_hash:
          type: string
        role:
          type: string
          enum: [ADMIN]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    AdminCreateRequest:
      type: object
      required: [username, password_hash, role]
      properties:
        username:
          type: string
        password_hash:
          type: string
        role:
          type: string
          enum: [ADMIN]

    AdminUpdateRequest:
      type: object
      required: [username, password_hash, role]
      properties:
        username:
          type: string
        password_hash:
          type: string
        role:
          type: string
          enum: [ADMIN]

    AdminResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              $ref: '#/components/schemas/Admin'

    ParcelStatus:
      type: string
      enum: [PICKED_UP, CANCELLED, EXPIRED]

    ParcelDetail:
      type: object
      required: [parcel_id, parcel_code, status, locker_id, size]
      properties:
        parcel_id:
          type: string
          format: uuid
        parcel_code:
          type: string
        status:
          $ref: '#/components/schemas/ParcelStatus'
        locker_id:
          type: string
          format: uuid
        compartment_id:
          type: string
          format: uuid
          nullable: true
        size:
          type: string
          enum: [S, M, L]
        receiver_phone:
          type: string
        sender_phone:
          type: string
        pickup_code:
          type: string
        reserved_at:
          type: string
          format: date-time
          nullable: true
        deposited_at:
          type: string
          format: date-time
          nullable: true
        picked_up_at:
          type: string
          format: date-time
          nullable: true
        expires_at:
          type: string
          format: date-time
          nullable: true

    ParcelDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              $ref: '#/components/schemas/ParcelDetail'
      example:
        success: true
        data:
          parcel_id: "d290f1ee-6c54-4b01-90e6-d701748f0851"
          parcel_code: "PARCEL-001"
          status: PICKED_UP
          locker_id: "3c4f5a7d-1111-4b4c-a222-9f3e8d6c1111"
          compartment_id: "c1f5c1a4-1234-4f0f-9a4b-1234567890ab"
          size: M
          receiver_phone: "0890001111"
          sender_phone: "0890002222"
          pickup_code: "PU-1234"
          reserved_at: "2025-01-01T10:00:00Z"
          deposited_at: "2025-01-01T10:30:00Z"
          picked_up_at: "2025-01-01T11:00:00Z"
          expires_at: "2025-01-02T10:30:00Z"

    Location:
      type: object
      properties:
        location_id:
          type: string
          format: uuid
        code:
          type: string
        name:
          type: string
        address:
          type: string
          nullable: true
        is_active:
          type: boolean

    Locker:
      type: object
      properties:
        locker_id:
          type: string
          format: uuid
        locker_code:
          type: string
        location_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [ACTIVE, MAINTENANCE, DISABLED]

    Compartment:
      type: object
      properties:
        compartment_id:
          type: string
          format: uuid
        compartment_no:
          type: integer
        size:
          type: string
          enum: [S, M, L]
        status:
          type: string
          enum: [AVAILABLE, RESERVED, OCCUPIED, OUT_OF_SERVICE]

    AdminOverview:
      type: object
      properties:
        total_locations:
          type: integer
        total_lockers:
          type: integer
        total_compartments:
          type: integer
        compartments_available:
          type: integer
        parcels_active:
          type: integer
        parcels_expired:
          type: integer

    LocationCreateRequest:
      type: object
      required: [code, name]
      properties:
        code:
          type: string
        name:
          type: string
        address:
          type: string
        is_active:
          type: boolean

    LocationResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              $ref: '#/components/schemas/Location'
      example:
        success: true
        data:
          location_id: "5e10ce9e-3e2e-42fd-9c3f-8b59af420001"
          code: LOC-001
          name: Main Hub
          is_active: true

    LocationListResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Location'

    LockerCreateRequest:
      type: object
      required: [location_id, locker_code]
      properties:
        location_id:
          type: string
          format: uuid
        locker_code:
          type: string
        name:
          type: string

    LockerResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              $ref: '#/components/schemas/Locker'
      example:
        success: true
        data:
          locker_id: "3c4f5a7d-1111-4b4c-a222-9f3e8d6c1111"
          locker_code: LCK-001
          location_id: "5e10ce9e-3e2e-42fd-9c3f-8b59af420001"
          status: ACTIVE

    LockerListResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Locker'

    LockerAvailable:
      type: object
      required: [locker_id, locker_code, location_name]
      properties:
        locker_id:
          type: string
          format: uuid
        locker_code:
          type: string
        location_name:
          type: string

    LockerAvailableResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/LockerAvailable'
      example:
        success: true
        data:
          - locker_id: "3c4f5a7d-1111-4b4c-a222-9f3e8d6c1111"
            locker_code: LCK-001
            location_name: Main Hub

    LockerStatusUpdateRequest:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [ACTIVE, MAINTENANCE, DISABLED]

    LockerStatusResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              type: object
              required: [locker_id, status]
              properties:
                locker_id:
                  type: string
                  format: uuid
                status:
                  type: string
                  enum: [ACTIVE, MAINTENANCE, DISABLED]

    CompartmentBatchCreateRequest:
      type: object
      required: [compartments]
      properties:
        compartments:
          type: array
          items:
            type: object
            required: [compartment_no, size]
            properties:
              compartment_no:
                type: integer
              size:
                type: string
                enum: [S, M, L]

    CompartmentBatchCreateResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              type: object
              required: [created_count]
              properties:
                created_count:
                  type: integer

    CompartmentListResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Compartment'

    AdminOverviewResponse:
      allOf:
        - $ref: '#/components/schemas/APIBase'
        - type: object
          required: [data]
          properties:
            data:
              $ref: '#/components/schemas/AdminOverview'
      example:
        success: true
        data:
          total_locations: 2
          total_lockers: 5
          total_compartments: 120
          compartments_available: 80
          parcels_active: 25
          parcels_expired: 3

tags:
  - name: Parcels
    description: Parcel read endpoints
  - name: Lockers
    description: Public locker lookup endpoints
  - name: Admin
    description: Admin operations and monitoring
